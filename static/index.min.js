(async()=>{let{protocol:i,host:s,search:e,origin:n}=location,{v:a,f:o}=Object.fromEntries(new URLSearchParams(e));function r(i,s,n=!1){var e=(e,t)=>n?s(e[i])-s(t[i]):s(t[i])-s(e[i]),{sort:t,slice:a,toSorted:o}=Array.prototype;return o?.call(this,e)||t.call(a.call(this),e)}let l=await fetch("/constant").then(e=>e.json()),c=new Vue({data:{originDomain:l.domain.originDomain,thirdDomain:l.domain.thirdDomain,instruction:null,overlay:{pics:!1,error:!1,serial:!1,history:!1,magnet:!1,reflow:!1,isfloat:!1,proxies:!1,sidenav:!1,dashboard:!1},fragment:{size:l.dataOptionsNomarl.fragment.size,idx:l.dataOptionsNomarl.fragment.idx},chat:{overlay:{textSwitch:!1},textMessage:"",group:[],state:l.dataOptionsNomarl.chat.state,enable:!1,session:"",socket:null,mediaRecorder:null,voiceChunks:[]},main:{page:0,actors:l.dataOptionsNomarl.main.actors,log:l.dataOptionsNomarl.main.log,select:l.dataOptionsNomarl.main.select,mode:l.dataOptionsNomarl.main.mode,state:l.dataOptionsNomarl.main.state,error:"",factor:"",serial:"",keyWord:"",heartbeat:null,slideRate:l.dataOptionsNomarl.main.slideRate,socket:null,needReconnect:!0,reconnectTimeout:l.dataOptionsNomarl.main.reconnectTimeout},manual:{bookmark:!1,origin:!0},status:{isdone:!0,vthumb:!0,autoview:!1,single:!1,stars:!1,genre:!1,studio:!1,label:!1,director:!1,deny:!1,onunc:!1},preview:{pics:[],picsIndex:-1,picsEl:null,viewerEl:null,prevRevealEl:null,picsSwipe:!1,picsSwipeSize:0,desktopSwipeScale:2,picsFailed:l.domain.picsFailed,touches:0},magnet:[],reflow:[],bookmark:[],taglist:{},dynamiclist:[],history:[],sconf:null,observer:null,offset:null,debounce:{nav:null,slide:null,scroll:null,update:null,observer:null,heartbeat:null,swipeInterval:null,prefixScroll:null,prefixScale:null},throttled:{load:null,press:null,slowSwipe:null},demoDebug:{name:l.demoDebug.name,enable:l.demoDebug.enable,magnet:l.demoDebug.magnet,genre:l.demoDebug.genre,single:l.demoDebug.single,vendor:l.demoDebug.vendor,actor:l.demoDebug.actor,actorOrigin:l.demoDebug.actorOrigin,previewOrigin:l.demoDebug.previewOrigin},deviceMeta:{viewWidth:0,viewHeight:0,isMobile:!1,isTablet:!1,isDesktop:!1,destopExpandWScale:2,destopExpandHScale:1.5,os:null},proxies:[],theme:"normal",description:"standard"},methods:{async selectProxy(e){if(this.status.isdone)return this.status.isdone=!1,this.overlay.reflow=!1,this.overlay.proxies=!1,this.main.log=await fetch(""+l.resourceRouter.toggleProxy+(e+l.constantNumber.passProxy)).then(e=>e.text()),this.proxies=this.snippetArray((await fetch(l.resourceRouter.proxies).then(e=>e.json())).slice(l.constantNumber.passProxy),l.snippet.proxy),this.status.isdone=!0,null;alert(l.constantString.alertString.selectProxy)},async updateProxy(){this.overlay.reflow=!1,this.main.log=await fetch(l.resourceRouter.updateProxy).then(e=>e.text())},flushHistory(){return this.overlay.history=this.history.length,this.history=Object.keys(localStorage).filter(e=>e!=l.constantString.flagString._data),null},loadHistory(e){e=JSON.parse(localStorage.getItem(e));return this.jumpLocation(e.sconf.keyWord,e.description),null},autoScroll({touches:[i]}){this.debounce.prefix=setTimeout(()=>{this.offset=Math.floor(this.$refs.box.scrollTop);let e=i.clientX>=window.innerHeight>>2,t=(cancelAnimationFrame(this.debounce.slide),()=>{this.offset+=e?this.main.slideRate:-this.main.slideRate,this.scrollToTop(null,l.constantString.flagString.autoScrollBehavior),this.debounce.slide=requestAnimationFrame(t)});t()},l.timer.invokeAutoScroll)},stopScroll(){clearTimeout(this.debounce.prefix),cancelAnimationFrame(this.debounce.slide)},import_(){var e;if(console.log(this.main.serial),/^[a-zA-Z]+-\d+(\s*,\s*[a-zA-Z]+-\d+)*$/.test(this.main.serial))return this.dynamiclist=[],this.overlay.reflow=!1,this.overlay.serial=!1,(e=this.main.serial.split(",")).forEach(e=>{this.main.socket.send(JSON.stringify({type:"search",keyWord:e,range:[1]}))}),this.main.log=l.constantString.flagString.import+":"+e.length,null;alert(l.constantString.alertString.import_)},export_(){var e=this.filterRule.map(({m:e})=>e.find(({href:e,text:[t]})=>/uncen/gi.test(t)?e:null)).map(e=>e.href).join(";");return navigator.clipboard.writeText(e),this.main.log=l.constantString.alertString.export_,null},toggleItem(i){return this.instruction[i].expand=!this.instruction[i].expand,this.instruction.forEach((e,t)=>{t!=i&&(e.expand=!1)}),null},recordStart(e){return this.chat.voiceChunks=[],console.log(e),e.target.classList.toggle("bgc"),this.chat.mediaRecorder.start(),this.throttled.press=setTimeout(()=>{this.chat.mediaRecorder.stop()},6e4),null},recordStop(e){return console.log("sss"),this.chat.mediaRecorder.stop(),e.target.classList.toggle("bgc"),clearTimeout(this.throttled.press)},search(){if(!this.status.isdone)return alert(l.constantString.alertString.search);if(3==!this.main.socket.readyState)return this.main.log=l.constantString.flagString.socketDisconnect;this.reflow=[],this.dynamiclist=[],this.status.isdone=!1,this.overlay.history=!1,this.description=(this.status.stars?"star":this.status.genre&&"genre")||(this.status.studio?"studio":this.status.label&&"label")||(this.status.director?"director":"standard");var i={type:"search",stars:this.status.stars,genre:this.status.genre,onsunc:this.status.onsunc,director:this.status.director,studio:this.status.studio,label:this.status.label,deny:this.status.deny};if(this.main.keyWord.includes(l.constantString.flagString.searchSplit)){let[e,t]=this.main.keyWord.split(l.constantString.flagString.searchSplit);t=t.split(l.constantString.flagString.searchPageSplit),this.main.page=1<t.length?t[1]:t[0],this.sconf={...i,keyWord:e,range:t}}else this.main.page=1,this.sconf={...i,keyWord:this.main.keyWord,range:[this.main.page]};return this.main.socket.send(JSON.stringify(this.sconf)),null},searchGenre(e){return this.main.keyWord=e,this.search(),null},async sleep(t){return new Promise(e=>{setTimeout(()=>{e(null)},t)})},async loadView(e){this.main.log=e.n,this.status.isdone=!1;var t=await fetch(""+l.resourceRouter.views+e.n).then(e=>e.text());return this.main.log=""+e.n+l.constantString.flagString.logFormat+t,c.$set(e,"v",parseInt(t)),this.main.log=l.constantString.flagString.done,this.status.isdone=!0,null},async loadViews(){if(this.dynamiclist.length){this.status.isdone=!1;let i=[];var e=this.filterRule.filter(({v:e})=>!e),t=(this.main.log=e.length,this.snippetArray(e,l.snippet.views));for(let e=0;e<=t.length-1;e++)await this.sleep(l.timer.viewsLoadDealy),t[e].forEach(async(t,e)=>{i.push((async()=>{var e;if(!t?.v||-1==t.v)return e=await fetch(""+l.resourceRouter.views+t.n).then(e=>e.text()),this.main.log=""+t.n+l.constantString.flagString.logFormat+e,c.$set(t,"v",parseInt(e)),{n:t.n,view:e}})())});Promise.allSettled(i).then(e=>{this.main.log=l.constantString.flagString.done,this.status.isdone=!0})}return null},reflowBack(e,t){return this.status.isdone=!1,this.main.socket.send(JSON.stringify({type:"search",keyWord:e,range:[1]})),null},reflowList(){return this.reflow.forEach(({value:{n:e}})=>{this.main.socket.send(JSON.stringify({type:"search",keyWord:e,range:[1]}))}),null},clearList(){return this.reflow=[]},onlyPush(e,t,i){return this.dynamiclist.push({n:e,...t,r:!1}),this.reflow.splice(i,1),null},stop(){return this.main.socket.send(JSON.stringify({type:"abort"})),null},reset(){return localStorage.clear(),this.main.socket.close(),location.href=n,null},home(){return location.href=n,null},save(){var e=document.documentElement.outerHTML,e=URL.createObjectURL(new Blob([e],{type:"text/html"})),t=document.createElement("a");return t.href=e,t.download=this.main.keyWord,document.body.appendChild(t),t.click(),document.body.removeChild(t),null},jumpLocation(e,t){return location.href=n+`?v=${e}&f=`+(t.includes("star")?t+"s":t)},jumpTag(t){this.throttled.press=setTimeout(()=>{var e=new URL(t).pathname.split("/");this.jumpLocation(e[2],e[1])},l.timer.jumpTagTimeout)},cancelJump(){return clearTimeout(this.throttled.press)},debouncefn(t,i){let s;return function(...e){clearTimeout(s),s=setTimeout(()=>{t(...e)},i)}},throttledfn(t,i){let s=null;return function(...e){s||(t(...e),s=setTimeout(()=>{s=null},i))}},loadMorePage({target:s}){return clearTimeout(this.debounce.scroll),this.debounce.scroll=setTimeout(()=>{var{clientHeight:e,scrollHeight:t,scrollTop:i}=s,t=t-Math.ceil(i);this.offset=Math.floor(i),Math.abs(t-e)<=2&&!this.throttled.load&&this.status.isdone&&this.dynamiclist.length&&!this.manual.bookmark&&(this.main.page++,this.status.isdone=!1,this.main.socket.send(JSON.stringify({...this.sconf,range:[this.main.page]})),this.throttled.load=setTimeout(()=>{this.throttled.load=null},l.timer.morePageInterval))},l.timer.scrollDebounce),null},snippetArray(e,t){let i,s;i=s=0;for(var n=[];s<=e.length;)[s,i]=[i+t,s],i!=s&&n.push(e.slice(i,s));return n},zoomPics({i:e}){return this.preview.pics=e||[],this.overlay.pics=e.length,null},async openSwipe(e,{target:t}){this.preview.picsIndex=e,this.preview.picsEl=t,this.preview.picsEl.classList.add(l.constantString.classString.swipe),await this.sleep(l.timer.openSwipeTimeout),this.preview.picsSwipe=!this.preview.picsSwipe},async closeSwipe(){return this.preview.picsIndex=-1,this.preview.picsSwipe=!this.preview.picsSwipe,await this.sleep(l.timer.closeSwipeTimeout),this.preview.picsEl.classList.remove(l.constantString.classString.swipe),null},nextSwipePics(){let e=this.preview.viewerEl;return e.style.transitionDuration=l.timer.swipeTransitionTimeout+"ms",e.lock||(e.lock=!0,this.preview.picsIndex++,this.$nextTick(()=>{this.debounce.swipeInterval=setTimeout(()=>{this.preview.picsIndex==c.preview.pics.length+1&&(e.style.transitionDuration="0s",this.preview.picsIndex=1),e.lock=!1},l.timer.swipeTransitionTimeout)})),null},prevSwipePics(){let e=this.preview.viewerEl;e.style.transitionDuration=l.timer.swipeTransitionTimeout+"ms",e.lock||(e.lock=!0,this.preview.picsIndex--,this.$nextTick(()=>{this.debounce.swipeInterval=setTimeout(()=>{0==this.preview.picsIndex&&(e.style.transitionDuration="0s",this.preview.picsIndex=this.preview.pics.length),e.lock=!1},l.timer.swipeTransitionTimeout)}))},expandMagnet(e){return this.magnet=e,this.overlay.magnet=e?.length,null},async updateBookmark(e,t,{target:i}){this.main.log=t;var i=i.closest(l.constantString.classString.revealBox).querySelector(l.constantString.classString.revealEl),s=l.bookmark[t];switch(t){case"insert":this.main.socket.send(JSON.stringify({type:"INSERT",data:e}));break;case"remove":this.main.socket.send(JSON.stringify({type:"REMOVE",data:e.n}))}return i.__recoverReveal(),await this.sleep(s.delay),this.flushBookMark(),null},async flushBookMark(e){return e&&(this.status.isdone=!e),this.bookmark=await fetch(l.resourceRouter.bookmark).then(e=>e.json()),null},visibNav(){return this.overlay.sidenav=!0,clearTimeout(this.debounce.nav),this.debounce.nav=setTimeout(()=>{this.overlay.sidenav=!1},l.timer.visibilityNavBar),null},connect(){return console.log("connect"),new Promise(e=>{this.main.socket=new WebSocket(`${i.includes("https:")?"wss":"ws"}://`+s+l.websocket.main),this.main.socket.onopen=()=>{e(null),console.log("WebSocket OPEN"),this.main.socket.addEventListener("message",async({data:e})=>{let i=JSON.parse(e);switch(i.type){case"ping":var t=Date.now()-parseInt(i.data);this.main.socket.send(JSON.stringify({type:"pong",data:t})),this.main.heartbeat=t,clearInterval(this.debounce.heartbeat),this.debounce.heartbeat=setInterval(()=>{this.main.socket.close()},l.timer.heartbeatDetectCycle);break;case"LOG":this.main.log=i.data.n+"<==>"+i.data.c;break;case"DONE":this.main.log=i.data.m,i.data.reflow.length&&(this.reflow=function(e,t){const i=new Set;return e.filter(({value:e})=>{e=e[t];return i.has(e)?null:i.add(e)})}([...this.reflow,...i.data.reflow],"n")),this.status.isdone=!0,this.sconf?.keyWord&&localStorage.setItem(""+this.sconf?.keyWord+l.constantString.flagString._data,JSON.stringify({...c._data,taglist:null,instruction:null,constant:null,bookmark:null}));break;case"ERROR":this.main.log=i.data.err;break;case"START":this.main.log=i.data.m;break;case"CENSORED":t={...i.data,i:i.data.i.map(e=>({pt:e,loaded:!1})),gs:!1,vs:!1,as:!1};this.dynamiclist.push(t),this.reflow.length&&this.reflow.find(({value:{n:e}},t)=>i.data.n==e?this.reflow.splice(t,1):null)}})},this.main.socket.onclose=()=>{console.log("WebSocket CLOSE"),clearInterval(this.main.heartbeat),this.main.needReconnect&&setTimeout(this.connect,this.main.reconnectTimeout)},this.main.socket.onerror=e=>{console.log("WebSocket ERROR"),this.main.socket.close()}})},scrollToTop(e,t){return this.$refs.box.scrollTo({top:e||this.offset||0,behavior:t||l.constantString.flagString.scrollBehavior}),null},loadNext(){return this.status.isdone&&this.sconf?(this.main.page++,this.main.socket.send(JSON.stringify({...this.sconf,range:[this.main.page]})),this.status.isdone=!1):alert(l.constantString.alertString.loadNext),null},filterCallback(){var e=[];return"NONE"==this.main.select&&this.main.factor&&e.push("(i.n?.toLocaleLowerCase()?.includes(this.main.factor))"),"TIME"==this.main.select&&4==this.main.factor?.length&&e.push("(i.d?.slice(0, 4) >= this.main.factor)"),this.status.single&&e.push("(i.s?.length || -1) == this.main.actors"),"censored"==this.main.mode&&e.push("i"),"uncensored"==this.main.mode&&e.push("i.r"),e.join(" && ")},connectDetect(){return setInterval(()=>{switch(this.main.socket.readyState){case this.main.socket.CONNECTING:this.main.state=l.websocket.connectState.connecting;break;case this.main.socket.OPEN:this.main.state=l.websocket.connectState.open;break;case this.main.socket.CLOSING:this.main.state=l.websocket.connectState.closing;break;case this.main.socket.CLOSED:this.main.state=l.websocket.connectState.closed}},l.timer.connectDetect),null},initTheme(){var e=(new Date).getHours();this.theme=(l.themes.day.range[0]<=e&&e<=l.themes.day.range[1]?l.themes.day:l.themes.night.range[0]<=e&&e<=l.themes.night.range[1]?l.themes.night:l.themes.normal).name},cssTemplate(n){return Object.keys(n).map(e=>{var t,i,s=[];for([t,i]of Object.entries(n[e]))s.push(`${t}:${i};`);return`${e}{${s.join("")}}`}).join("")},thumbSucess({target:e}){return e.classList.add(l.constantString.classString.loaded),null},thumbFailed(){},listenTouches(){window.addEventListener("touchstart",e=>{this.preview.touches=e.touches.length,2<=e.touches.length&&e.preventDefault()},{passive:!1})},listenResize(){window.addEventListener("resize",this.debouncefn(this.initDeviceMeta,l.timer.initSwipeDebounce))},initDeviceMeta(){var e=navigator.platform.toLowerCase(),t=navigator.userAgent.toLowerCase();return this.deviceMeta.os=(e.includes("win")?"Windows":e.includes("mac")&&"MacOS")||(e.includes("linux")?"Linux":"Unknown"),this.deviceMeta.isMobile=/mobile|android|iphone|ipad|ipod|blackberry|windows phone/i.test(t)||"ontouchstart"in window||navigator.maxTouchPoints||!1,this.deviceMeta.isTablet=/ipad|android/i.test(t)&&!this.deviceMeta.isMobile,this.deviceMeta.isDesktop=!this.deviceMeta.isMobile&&!this.deviceMeta.isTablet,this.deviceMeta.viewWidth=window.innerWidth,this.deviceMeta.viewHeight=window.innerHeight,this.$refs.box.style.height=this.deviceMeta.viewHeight+"px",document.documentElement.style.fontSize=l.snippet.smallScreenWidth>=this.deviceMeta.viewWidth?l.flexibleSize.small:l.flexibleSize.big,null},initVueOption(e,t,i={}){var s={...t,...i};for(const n in s)e[n]=s[n];return null},initObserver(){this.observer=new IntersectionObserver((e,i)=>{e.forEach(async({target:e,isIntersecting:t})=>{t?(e.src!=e.dataset.src&&e.setAttribute("src",e.dataset.src),this.status.autoview&&!this.filterRule[e.dataset.i].v&&(this.main.log=e.dataset.n,t=await fetch(""+l.resourceRouter.views+e.dataset.n).then(e=>e.text()),c.$set(this.filterRule[e.dataset.i],"v",parseInt(t))),i.unobserve(e)):e.classList.contains(l.constantString.classString.loaded)&&e.classList.remove(l.constantString.classString.loaded)})},{rootMargin:"0px 0px 0px 0px",threshold:0})},async chatDeviceRequest(){console.log("init");var e=await navigator.mediaDevices.getUserMedia({audio:!0});await navigator.mediaDevices.enumerateDevices(),await navigator.mediaDevices.getSupportedConstraints(),navigator.userAgent;return e.getAudioTracks().forEach(e=>{console.log(e);e.id,e.kind,e.label,e.muted,e.enabled,e.readyState}),this.chat.mediaRecorder=new MediaRecorder(e),this.chat.mediaRecorder.ondataavailable=e=>{0<e.data.size&&this.chat.voiceChunks.push(e.data)},this.chat.mediaRecorder.onstop=async()=>{console.log(this.chat.voiceChunks);var e=new Blob(this.chat.voiceChunks,{type:"audio/wav"});this.chat.socket.send(await e.arrayBuffer())},null},chatConnect(){return new Promise(e=>{this.chat.socket=new WebSocket(`${i.includes("https:")?"wss":"ws"}://`+s+l.websocket.chat),this.chat.socket.onopen=()=>{e(null),console.log("WebSocket OPEN"),this.chat.socket.addEventListener("message",async({data:e})=>{var t;if(console.log(e),e instanceof Blob)return t=new Blob([e],{type:"audio/wav"}),t=URL.createObjectURL(t),(t=new Audio(t)).setAttribute("controls",1),t.setAttribute("autoplay",1),document.body.appendChild(t),null;var i=JSON.parse(e);switch(i.type){case"AUTH":this.chat.session=i.UUID;break;case"ONLINE":this.chat.group=i.group}})},this.chat.socket.onclose=()=>{console.log("WebSocket CLOSE")},this.chat.socket.onerror=e=>{console.log("WebSocket ERROR"),this.chat.socket.close()}})}},filters:{actorTotal(e){return e?.length||-1},extract(e,t){return e=e.match(/\/(\w+)$/)?.[1]??e,t?t?.[e]??e:e},getProgress(e){return e?.filter(({loaded:e})=>1==e)?.length??0},purgeSuffix(e){return e?.replace(l.constantString.flagString._data,"")},uniqueKey(e){return""+Date.now()},lastSuffix(e,t){return e>=t-l.snippet.endFlag&&""+e+l.constantString.flagString.endFlag||e}},directives:{lazyLoadOberver:{bind(e,t,i){},inserted(e,i,s){console.log(e.dataset.i),console.log(t++)}},pressAutoScroll:{bind(e,t){let s=t.value;e.__stopScroll=()=>{clearTimeout(s.debounce.prefixScroll),cancelAnimationFrame(s.debounce.slide)},e.__autoScroll=({touches:[i]})=>{s.debounce.prefixScroll=setTimeout(()=>{s.offset=Math.floor(s.$refs.box.scrollTop);let e=i.clientX>=window.innerHeight>>2,t=(cancelAnimationFrame(s.debounce.slide),()=>{s.offset+=e?s.main.slideRate:-s.main.slideRate,s.scrollToTop(null,l.constantString.flagString.autoScrollBehavior),s.debounce.slide=requestAnimationFrame(t)});t()},l.timer.invokeAutoScroll)},e.addEventListener("touchstart",e.__autoScroll,{passive:!0}),e.addEventListener("touchmove",e.__stopScroll,{passive:!0}),e.addEventListener("touchend",e.__stopScroll),e.addEventListener("touchcancel",e.__stopScroll)},unbind(e){e.removeEventListener("touchstart",e.__autoScroll),e.removeEventListener("touchmove",e.__stopScroll),e.removeEventListener("touchend",e.__stopScroll),e.removeEventListener("touchcancel",e.__stopScroll)}},pressAutoScale:{bind(t,e){let i=e.value;t.__startScale=e=>{e.stopPropagation(),i.debounce.prefixScale=setTimeout(()=>{t.classList.add(l.constantString.classString.thumbScale)},l.timer.scaleThumbTimeout)},t.__stopScale=()=>{clearTimeout(i.debounce.prefixScale),t.classList.remove(l.constantString.classString.thumbScale)},t.addEventListener("touchstart",t.__startScale,{passive:!0}),t.addEventListener("touchend",t.__stopScale,{passive:!0})},unbind(e){e.removeEventListener("touchstart",e.__startScale),e.removeEventListener("touchend",e.__stopScale),e.removeEventListener("touchcancel",e.__stopScale)}},swipeCarouselPics:{bind(i,e){let s=e.value;i.lock=!1,i.enterSwipe=(e,t)=>{clearTimeout(s.throttled.slowSwipe),i.style.transitionDuration=l.timer.swipeTransitionTimeout+"ms",Math.abs(e)>=("fast"==i.swipeMode&&i.threshold||"slow"==i.swipeMode&&i.slowSwipe)&&(s.preview.picsIndex==s.preview.pics.length+1&&0==s.preview.picsIndex||(0<e?s.preview.picsIndex++:s.preview.picsIndex--)),s.$nextTick(()=>{s.debounce.swipeInterval=setTimeout(()=>{(i.picsChangeIndex=s.preview.picsIndex==s.preview.pics.length+1&&0<=e?1:0==s.preview.picsIndex&&e<=0&&s.preview.pics.length)&&(i.style.transitionDuration="0s",s.preview.picsIndex=i.picsChangeIndex),i.lock=!1},l.timer.swipeTransitionTimeout)}),i.style.transform=`translate3d(${t}px,0,0)`},i.initPicsSwipeSize=()=>{s.preview.picsSwipeSize=-i.getBoundingClientRect().width,i.slowSwipe=Math.abs(s.preview.picsSwipeSize/2)},s.preview.viewerEl=i,s.$nextTick(i.initPicsSwipeSize),window.addEventListener("resize",s.debouncefn(i.initPicsSwipeSize,l.timer.initSwipeDebounce)),i.threshold=l.snippet.swipeThreshold,i.__handleTouchStart=({touches:[e]})=>{i.touchDeltaX=0,i.touchStartX=0,i.style.transitionDuration="0s",i.touchCurrentX=s.preview.picsSwipeSize*s.preview.picsIndex,i.touchStartX=e.clientX,i.swipeMode="fast",clearTimeout(s.throttled.slowSwipe),s.throttled.slowSwipe=setTimeout(()=>{i.swipeMode="slow"},l.timer.swipeSlowTimeout)},i.__handleTouchMove=({touches:[e]})=>{i.lock||(i.touchDeltaX=i.touchStartX-e.clientX,i.style.transform=`translate3d(${i.touchCurrentX-i.touchDeltaX}px,0,0)`)},i.__handleTouchEnd=()=>{i.lock||(i.lock=!0,i.enterSwipe(i.touchDeltaX,i.touchCurrentX))},i.addEventListener("touchstart",i.__handleTouchStart,{passive:!0}),i.addEventListener("touchmove",i.__handleTouchMove,{passive:!0}),i.addEventListener("touchend",i.__handleTouchEnd),i.__handleMouseDown=e=>{i.MouseDeltaX=0,i.MouseStartX=0,i.style.transitionDuration="0s",i.MouseCurrentX=s.preview.picsSwipeSize*s.preview.picsIndex,i.MouseStartX=e.clientX,i.addEventListener("mousemove",i.__handleMouseMove),i.addEventListener("mouseleave",i.__handleMouseUpAndLeave),i.swipeMode="fast",s.throttled.slowSwipe=setTimeout(()=>{i.swipeMode="slow"},l.timer.swipeSlowTimeout)},i.__handleMouseMove=e=>{i.lock||(i.MouseDeltaX=i.MouseStartX-e.clientX,i.style.transform=`translate3d(${i.MouseCurrentX-i.MouseDeltaX}px,0,0)`)},i.__handleMouseUpAndLeave=()=>{i.removeEventListener("mousemove",i.__handleMouseMove),i.removeEventListener("mouseleave",i.__handleMouseUpAndLeave),i.lock||(i.lock=!0,i.enterSwipe(i.MouseDeltaX,i.MouseCurrentX))},i.addEventListener("mousedown",i.__handleMouseDown),i.addEventListener("mouseup",i.__handleMouseUpAndLeave)},unbind(e){window.removeEventListener("resize",e.initPicsSwipeSize),e.removeEventListener("mousedown",e.__handleMouseDown),e.removeEventListener("mouseup",e.__handleMouseUpAndLeave),e.removeEventListener("touchstart",e.__handleTouchStart),e.removeEventListener("touchmove",e.__handleTouchMove),e.removeEventListener("touchend",e.__handleTouchEnd)}},swipeToReveal:{bind(i,e){let t=e.value;t.$nextTick(()=>{var{width:e,height:t}=i.getBoundingClientRect();i.__halfX=e/2,i.__revealY=t,i.__halfY=i.__revealY/2}),i.isOpen=!1,i.opacityCurrent="",i.__recoverReveal=function(){this.style.opacity="",this.style.transform="translate3d(0,0,0)",this.isOpen=!1},i.__handleTouchStart=({touches:[e]})=>{1==t.preview.touches&&(null==t.preview.prevRevealEl&&(t.preview.prevRevealEl=i),t.preview.prevRevealEl!=i&&(t.preview.prevRevealEl.__recoverReveal(),t.preview.prevRevealEl=i),i.touchDeltaX=0,i.touchStartX=0,i.touchDeltaY=0,i.touchStartY=0,i.touchCurrentX=0,i.opacity=0,i.revealing=!1,i.style.transitionDuration="0s",i.touchStartX=e.clientX,i.touchStartY=e.clientY)},i.__handleTouchMove=e=>{1==t.preview.touches&&(i.touchDeltaX=i.touchStartX-e.touches[0].clientX,i.touchDeltaY=i.touchStartY-e.touches[0].clientY,i.revealing||(i.slope=i.touchDeltaY/i.touchDeltaX),Math.abs(i.slope)<=l.snippet.tiltFactor||i.revealing)&&(e.preventDefault(),i.opacity=Math.abs(i.touchDeltaX)*l.snippet.revealOpacityFactor/i.__revealY,!i.isOpen&&Math.abs(i.touchDeltaX)<=i.__revealY&&0<i.touchDeltaX&&(i.opacityCurrent=1-i.opacity,i.style.opacity=i.opacityCurrent,i.style.transform=`translate3d(${-i.touchDeltaX}px,0,0)`,i.revealing=!0),i.isOpen)&&i.__revealY>=Math.abs(i.touchDeltaX)&&i.touchDeltaX<0&&(i.style.opacity=i.opacityCurrent+i.opacity,i.style.transform=`translate3d(${-i.__revealY-i.touchDeltaX}px,0,0)`,i.revealing=!0)},i.__handleTouchEnd=()=>{i.style.transitionDuration=l.timer.revealTransitionTimeout+"ms",!i.isOpen&&Math.abs(i.touchDeltaX)>=i.__halfY&&0<=i.touchDeltaX&&Math.abs(i.slope)<=l.snippet.tiltFactor?(i.style.opacity=l.snippet.revealOpacityFactor,i.style.transform=`translate3d(${-i.__revealY}px,0,0)`,i.isOpen=!0):i.__recoverReveal()},i.addEventListener("touchstart",i.__handleTouchStart,{passive:!0}),i.addEventListener("touchmove",i.__handleTouchMove,{passive:!1}),i.addEventListener("touchend",i.__handleTouchEnd)},unbind(e){e.removeEventListener("touchstart",e.__handleTouchStart),e.removeEventListener("touchmove",e.__handleTouchMove),e.removeEventListener("touchend",e.__handleTouchEnd)}}},watch:{filterRule:{async handler(e){console.log("watch"),clearTimeout(this.debounce.observer),this.debounce.observer=setTimeout(async()=>{await this.$nextTick(()=>{this.$refs.monitor?.forEach(this.observer.observe.bind(this.observer))})},l.timer.observerDebounce)},deep:!1},"main.factor":{handler(e){return this.main.factor=4<=e?.length?this.main.factor.slice(0,4):e},deep:!1},"status.stars":{handler(e){e&&(this.status.genre=!e)}},"status.genre":{handler(e){e&&(this.status.stars=!e)}},"preview.picsIndex":{handler(e){},deep:!1},"fragment.idx":{handler(e){this.fragment.idx=e>this.pageTotal?1:e<1?this.pageTotal:e},deep:!1},"overlay.pics":{handler(e){e&&(this.overlay.reflow=!e)},deep:!1},"manual.bookmark":{async handler(e){e?this.flushBookMark(!0):this.status.isdone=!0}},"main.error":{handler(e){e&&(this.overlay.error=!0,setTimeout(()=>{this.main.error=""},l.timer.errorMessageTimeout))}}},computed:{filterRule(){console.log("computed");var e=Function("return i=>"+this.filterCallback()).call(this);if(this.manual.bookmark)return this.$nextTick(this.scrollToTop),this.bookmark?.filter(e)??[];var t=this.main.factor?.includes(l.constantString.flagString.atniSortFlag)??!1;switch(this.main.select){case"NONE":return this.dynamiclist.filter(e);case"TIME":return r.call(this.dynamiclist.filter(e),"d",e=>new Date(e).getTime(),t);case"VIEW":return r.call(this.dynamiclist.filter(e),"v",e=>e,t)}},sliceReflow(){return this.reflow.slice(this.fragment.size*(this.fragment.idx-1),this.fragment.idx*this.fragment.size)},pageTotal(){var e=this.reflow.length%this.fragment.size,t=Math.floor(this.reflow.length/this.fragment.size);return e?t+1:t},switchTheme(){var e=document.createElement("style"),t=l.themes[this.theme].color,i=l.themes[this.theme].backgroundColor;e.textContent=this.cssTemplate({"*":{color:t,"--br-color":t,"--hv-color":i,"background-color":i,visibility:"visible"},".bookmark-action-svg path":{fill:t}}),document.body.append(e)}},async created(){console.log("created"),Vue.config.errorHandler=async(e,t,i)=>{console.log("Vue Error:",e),console.log("Vue Error Info:",i),t.main.error=e};var e=JSON.parse(localStorage.getItem(""+(a||"")+l.constantString.flagString._data)??"{}");this.initVueOption(this.$data,e,l.defaultStroageMeger),this.initObserver(),await this.connect(),this.connectDetect(),a&&(this.main.keyWord=a,this.status[o]=!0,this.dynamiclist.length||this.search())},async mounted(){console.log("mounted"),this.listenTouches(),this.initDeviceMeta(),this.listenResize(),this.initTheme(),this.scrollToTop(),this.proxies=this.snippetArray((await fetch(l.resourceRouter.proxies).then(e=>e.json())).slice(l.constantNumber.passProxy),l.snippet.proxy),this.taglist=await fetch(l.resourceRouter.tag).then(e=>e.json()),this.instruction=await fetch(l.resourceRouter.instruction).then(e=>e.json()),this.history=Object.keys(localStorage).filter(e=>e!=l.constantString.flagString._data),new IntersectionObserver((e,t)=>{e.forEach(async e=>{e.isIntersecting?this.overlay.isfloat=!1:this.overlay.isfloat=!0})},{rootMargin:"10px 0px 0px 0px",threshold:1}).observe(this.$refs.log)},updated(){clearTimeout(this.debounce.update),this.debounce.update=setTimeout(()=>{this.main.socket&&(console.log("updated"),localStorage.setItem(""+(a&&a==this.sconf.keyWord&&a||"")+l.constantString.flagString._data,JSON.stringify({...c._data,taglist:null,instruction:null,bookmark:null})))},l.timer.updateHookDebounce)}});c.$mount("#box")})();